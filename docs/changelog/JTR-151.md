# JTR-151

- Date: 2026-03-01
- Scope: add interactive dispatch map tab (Leaflet + OSM) with deterministic mock coordinates

## What changed

- Added `apps/web/components/dispatch/DispatchMapView.vue`:
  - Leaflet map with OpenStreetMap tile layer
  - markers color-coded by technician assignment
  - distinct marker style for unassigned tickets
  - marker popups with:
    - ticket title + schedule/meta
    - `View` action
    - `Assign` action for unassigned tickets
  - right-side panel `Today's Jobs` with count and clickable items
  - clicking list item centers map and opens marker popup
  - deterministic pseudo-coordinates from `ticketId + locationId` hash
- Updated `apps/web/pages/dispatch.vue`:
  - replaced map placeholder with `DispatchMapView`
  - connected map actions to existing ticket open / quick-assign flows
  - reused dispatch query-sync date as map day context
- Added map data contract type in `apps/web/types/ui.ts`:
  - `DispatchMapTicket`
- Added Leaflet integration wiring:
  - `apps/web/package.json`: `leaflet` dependency, `@types/leaflet` dev dependency
  - `apps/web/nuxt.config.ts`: Leaflet CSS included in global css
  - `apps/web/types/leaflet-shim.d.ts`: local shim for offline typecheck in restricted environment
- Updated architecture docs for temporary coordinate strategy:
  - `docs/architecture.md`
  - `docs/system-design.md`
- Updated UI/UX plan matrix:
  - `docs/plans/ui-ux-plan.md` with `JTR-151` follow-up row marked done

## Files

- `apps/web/components/dispatch/DispatchMapView.vue`
- `apps/web/pages/dispatch.vue`
- `apps/web/types/ui.ts`
- `apps/web/package.json`
- `apps/web/nuxt.config.ts`
- `apps/web/types/leaflet-shim.d.ts`
- `docs/architecture.md`
- `docs/system-design.md`
- `docs/plans/ui-ux-plan.md`
- `docs/changelog/JTR-151.md`

## Verification

- `pnpm -C /Users/vlad/Projects/JTrack/apps/web lint`
- `pnpm -C /Users/vlad/Projects/JTrack/apps/web typecheck`
